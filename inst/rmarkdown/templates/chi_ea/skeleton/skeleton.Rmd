---
#conference and copyright metadata
copyright: acmcopyright #otherwise e.g. none, acmlicensed, ...
copyright-year: 2016
DOI: 10.475/123_4
ISBN: 123-4567-24-567/08/06
conference: ACM Woodstock conference
conference-short: WOODSTOCK'97
conference-date: July 1997
conference-location: El Paso, Texas USA
acm-year: 1997
acm-price: 15.00
watermark: false #e.g. 'pre-print'
watermark-on-first-page-only: true

#paper metadata
title: Writing CHI Extended Abstracts With R Markdown
short-title: Extended Abstracts With R Markdown
short-authors: F. Author et al.
author:
  - name: First Author
    affiliation:
      institution: University of Author
      city: Authortown
      state: CA
      country: USA
      postcode: 94022
    email: author1\@anotherco.edu  #NOTE: you must escape the @
  - name: Second Author
    affiliation:
      position: VP, Authoring
      institution: Authorship Holdings, Ltd.
      city: Awdur
      country: UK
      postcode: SA22 8PP
    email: author2\@author.ac.uk
  - name: Third Author
    affiliation:
      institution: Lekhaka Labs
      city: Bengaluru
      postcode: 560 080
      country: India
    email: author3\@another.com
  - name: Fourth Author
    affiliation:
      institution: YetAuthorCor, Inc.
      city: Authortown
      state: BC
      country: Canada
      postcode: V6M 22P
    email: author4\@anotherco.com
  - name: Fifth Author
    affiliation:
      institution: Universit√© de Auteur-Sud
      city: Auteur
      country: France
      postcode: 40222
    email:  author5\@author.fr
  - name: Sixth Author
    affiliation:
      institution: University of Umbhali
      city: Pretoria
      country: South Africa
    email: author6\@umbhaliu.ac.za
abstract: This is a guided illustration of how to write a CHI Extended Abstracts paper in R Markdown, using the [ACM Master \LaTeX\ template](https://www.acm.org/publications/proceedings-template). #If you put the abstract in quotes, you must escape LaTeX syntax with an extra '\', e.g. '\\LaTeX\\'.
keywords: CHI Extended Abstracts; \LaTeX; R Markdown; reproducible papers
bibliography-path: sample-bibliography

#NOTE: 
# Output configurations are set in _output.yml
# The 'CCS Concepts' are generated by the file ccsxml.tex - change the content in there to reflect your article, using http://dl.acm.org/ccs.cfm
# if you don't want your paper to include CCS Concepts (allowed to save space in your submission), comment out 'include: in_header: ccsxml.tex' in _output.yml

---

```{r load_pkgs, include=FALSE}
# Packages required to use this template
pkg <- c("tidyverse", "knitr", "bookdown")
# Check if packages are not installed and assign the
# names of the packages not installed to the variable new.pkg
new.pkg <- pkg[!(pkg %in% installed.packages())]
# If there are any packages in the list that aren't installed,
# install them
if (length(new.pkg))
  install.packages(new.pkg, repos = "http://cran.rstudio.com")
# Load packages (thesisdown will load all of the packages as well)
```


```{r setup_output, include=FALSE}
library(knitr)

##### YOU MUST INCLUDE THE BELOW IN A CHUNK AT THE TOP OF YOUR .RMD SOURCE
##### TO CREATE ADDITIONAL CHUNK OPTIONS FOR E.G FIGURE DESCRIPTIONS
# out.extra ensures that knitr uses LaTeX code for figures, cf. https://stackoverflow.com/questions/42486617/knitr-ignoring-fig-pos
knitr::opts_chunk$set(out.extra = '')

# create additional chunk options
hook_chunk = knit_hooks$get('chunk')
knit_hooks$set(chunk = function(x, options) {
  txt = hook_chunk(x, options)

  # in margintables, remove the [t] that otherwises appears on top of the tables
  txt <- gsub('\\\\begin\\{margintable\\}\\[t\\]', '\\\\begin\\{margintable\\}', txt)
  
  # add chunk option 'vspaceout' to position chunks vertically with \vspace
  if (!is.null(options$vspaceout)) {
    latex_vspace <- paste0("\\1\\\\vspace\\{", options$vspaceout, "\\}")
    txt <- sub('(\\\\begin[^}]+})', latex_vspace, txt)  
  }
  
  # add chunk option 'description' which adds \Description{...} to figures
  if (!is.null(options$description)) {
    
    latex_include <- paste0("\\1\\\\Description\\{", options$description, "\\}")
    gsub('(\\\\includegraphics[^}]+})', latex_include, txt)  
  
  # add chunk option 'sidebar_caption' to add captions to a sidebar
  } else if (!is.null(options$sidebar_caption)) {
    
    latex_include <- paste0("\\\\caption\\{", options$sidebar_caption, "\\}\\1")
    gsub('(\\\\end\\{sidebar\\})', latex_include, txt)  
    
  } else {
    return(txt)  # pass to default hook    
  }
})

```


# Introduction{-}
Using a tool like [R Markdown](https://rmarkdown.rstudio.com) to write scientific papers makes your work more transparent and reproducible. It also reduces the risk of errors, because you can dynamically insert tables, figures, and summary statistics directly from the data they are generated from insted of transferring results manually from statistical software to manuscript.

This example illustrates how to use the ACM Master \LaTeX\ templates with R Markdown to write papers for the [CHI conference](https://sigchi.org), in the CHI Extended Abtracts format. The content in this example is adapted and adjusted from content in **sample-sigchi.tex** as well as **sample-sigchi-a.tex** included with the ACM template, to illustrate how to create the same content through an R Markdown workflow as well as to showcase additional features made possible by R Markdown.


```{block, type='sidebar', sidebar_caption="This is the optional caption", vspaceout='-5cm'}
**How to Make a Side Bar**

  **Use a [custom block](https://bookdown.org/yihui/bookdown/custom-blocks.html) of type 'sidebar'**. Sidebars need to be placed in the `sidebar` \LaTeX\ environment. To achieve that, use the syntax ```` ```{block, type='sidebar'} ```` to begin such a block, ending the block with another three backticks. Make sure the chunk option `echo` is set to `TRUE` to make the content of the block display.
  
  Use this approach for arbitrary text you want to put over here - for dynamically created tables and figures, there is a separate syntax, as will be explained later.
  
  - If you want to add a caption for this kind of sidebar, you can do it with the chunk option `sidebar_caption="This is my caption"`, which will add  `\caption{This is my caption}` in the LaTeX output.
  - If you want to move the sidebar up or down, use the chunk option `vspaceout`.
  - If you want a label so you can refer to the sidebar later on, add it with \LaTeX\ syntax directly within the chunk content, e.g. `\label{bar:arbitrary-sidebar}`.
  
\label{bar:arbitrary-sidebar}
```


# Paper meta data
Set meta data (copyright, authors, keywords, title, keywords, etc.) in the YAML header of the .Rmd file in which you write the manuscript. This is done in the form of `key: value` pairs, e.g. `title: Writing CHI Proceedings Papers With R Markdown`. When compiling to a PDF (in RStudio, just click the 'Knit' button), the information in the YAML header is plugged into the CHI Extended Abstracts \LaTeX\ template. (If you were to take a look at this template file inside of the rticles package, you would see e.g. `\title[$short-title$]{$title$}` where stuff between dollar signs is interpreted as a variable to be searched for in the YAML header and plugged into the template when generating a PDF).

**Note the sole exception for adding paper meta data**: The CCS Concepts are messy to insert from the YAML header, so you should manually insert this into the **ccsxml.tex** file from which it will be included into your manuscript.

# The Body of The Paper
Typically, the body of a paper has a hierarchical structure, with numbered or unnumbered headings for sections, subsections, sub-subsections, and paragraphs. Whereas in \LaTeX\ you use the command `\section` for main sections, in R Markdown you simply use `#`, as in `# The Body of The Paper`. For subsections, or sub-subsections, use additional hashes, as in `## This Become a Subsection`, and `#### This Becomes a Paragraph Heading`.^[By the way, this is how to insert footnotes. In the Extended Abstracts format, footnotes are displayed as side notes in the margin.] 

If you want some section to be unnumbered in the output, add `{-}` after the section name, as in `# Unnumbered Section{-}`.

Indicate the start of a new paragraph with a blank line in your input file; that is why this sentence forms a separate paragraph.
This line, however, does not form a separate paragraph.

## Type Changes and *Special* Characters
Make words or phrases *italicized* by surrounding them with a single \*; **embolden** them by surrounding them with \*\***two**\*\*. `Typewriter-style` (for instance, for computer code) you create by surrounding text with `` `backticks` ``.

## Citations
Citations to articles [@bowman:reasoning; @braams:babel; @Cohen07], conference proceedings [@clark:pct] or maybe books [@Lamport:LaTeX; @salas:calculus] listed in the Bibliography section of your article will occur throughout the text of your article. To insert a reference in the R Markdown syntax, type \@ followed by the citation key. The key is a short reference uniquely identifying each entry in in the `.bib` file for your article, in which your references are listed in [BibTex](http://www.bibtex.org) format.

For example, to cite the article "Deciding equivalances among conjunctive aggregate queries" from our `.bib` file, write `[@Cohen07]`. If you drop the `[]`'s, you get author names, as well as the citation: @Cohen07. See [this short guide for more](https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html).

# Dynamic reporting
One of the most important benefits of writing in R Markdown (aside from being able to compile to other formats than PDF, such as HTML or even Microsoft Word), is the ability to insert results dynamically into your manuscript using code chunks or inline code. This means that you can do analyses **directly** in your manuscript or, probably better, read file(s) with data, summaries, or results directly into your manuscript and refer to them dynamically.

This is important for two (related) reasons:
1. You avoid initial manual transfer of results from statistical software to manuscript, which reduces the risk of error.
2. If at a later stage you update the analysis files, the results reported in your manuscript are automatically also updated - this again reduces the risk of mistakes, because you don't need to manually update figures and tables.

In R Markdown syntax, **code chunks** have the following form (cf. [_R Markdown: The Definitive Guide_](https://bookdown.org/yihui/rmarkdown/r-code.html)):

````r
`r ''````{coding_language chunk-label, chunk_options}
# your code goes here
```
````

**Inline code** has the form `` `coding_language #code here` ``.

## Setup chunks and figure descriptions
The first chunk in an R Markdown document is usually used to load packages and set default chunk options, for example like so:

```{r setup, message=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)  
# these options will exclude code output, messages, or warnings in output
```

In addition, version **1.56** of the ACM Master template adds the ability to provide descriptions of figures via the latex command `\Description{my description`. To be able to add these descriptions easily via chunk options, as well as position chunk vertically and add sidebar captions, include this code in your initial setup chunk:

```r
# out.extra ensures that knitr uses LaTeX code for figures
knitr::opts_chunk$set(out.extra = '')

# create additional chunk options
hook_chunk = knit_hooks$get('chunk')
knit_hooks$set(chunk = function(x, options) {
  txt = hook_chunk(x, options)

  # in margintables, remove the [t] that otherwise appears on top of the tables
  txt <- gsub('\\\\begin\\{margintable\\}\\[t\\]', 
                  '\\\\begin\\{margintable\\}', txt)
  
  # add chunk option 'vspaceout' to position chunks vertically with \vspace
  if (!is.null(options$vspaceout)) {
    latex_vspace <- paste0("\\1\\\\vspace\\{", options$vspaceout, "\\}")
    txt <- sub('(\\\\begin[^}]+})', latex_vspace, txt)  
  }
  
  # add chunk option 'description' which adds \Description{...} to figures
  if (!is.null(options$description)) {
    
    latex_include <- paste0("\\1\\\\Description\\{", options$description, "\\}")
    gsub('(\\\\includegraphics[^}]+})', latex_include, txt)  
  
  # add chunk option 'sidebar_caption' to add captions to a sidebar
  } else if (!is.null(options$sidebar_caption)) {
    
    latex_include <- paste0("\\\\caption\\{", options$sidebar_caption, "\\}\\1")
    gsub('(\\\\end\\{sidebar\\})', latex_include, txt)  
    
  } else {
    return(txt)  # pass to default hook    
  }
})

```

You can then add descriptions to your figures by setting `description="my description` as a chunk option to images and plots as you will see below.

## Inline results
You might read in a made-up data set of goals scored by basketball players like so:

```{r, echo=TRUE}
data <- read_csv("data/fakeBasketData.csv")
```

You can then use inline code to dynamically report properties of this data set. For example, "there are a total of `r nrow(data)` observations of goals scored. The mean number of goals made by any player in a given game is: `r mean(data$goals)`".

## Tables
You can also automatically create corresponding LaTeX tables from your data The easiest way is probably to use [kable function](https://rdrr.io/cran/knitr/man/kable.html) For example, Table \@ref(tab:basket-data) shows the first 5 rows in our basket data set.

```{r basket-data}
data %>%
  head(5) %>%
  knitr::kable(format = "latex", booktabs = TRUE, caption = "The first 5 rows of some made-up basket data.")
```

You can reference Table \@ref(tab:basket-data) with `\@ref(tab:basket-data)`.

You can also do arbitrary transformations and analyses of the data before creating a table, as in Table \@ref(tab:basket-summary).

```{r basket-summary, vspaceout='-3cm'}
data %>%
  group_by(Player) %>%
  summarise(`Total goals scored` = sum(goals)) %>%
  head(3) %>%
  knitr::kable(format = "latex", table.env = 'margintable', caption = "Summary statistics of goals scored by top players in made-up basketball season.", booktabs = TRUE)
```

### Margin tables
To place a table in the margin, put it in a `\margintable` environment by adding the parameter `table.env = 'margintable'` when calling the `kable` function, like in Table \@ref(tab:basket-summary).

### Full width tables
To make a table take up the whole width of the page, put it in a `\table*` environment by adding the parameter `table.env = 'table*'` to `kable`, as in Table \@ref(tab:basket-summary-wide).

```{r basket-summary-wide}
data %>%
  group_by(Player) %>%
  summarise(`Total goals scored` = sum(goals),
             `Goals per game` = `Total goals scored` / n()) %>%
  mutate(`Length of name` = map_int(Player, str_length),
         `Goals per letter in name` = `Total goals scored` / `Length of name`,
         `Goals per letter per game` = `Goals per letter in name`/n()) %>%
  knitr::kable(format = "latex", booktabs = TRUE, caption = "Bigger display of more summary statistics of goals scored by top players in made-up basketball season.", table.env = 'table*') #note table.env = 'table*'
```

## Figures
### Static figures
Figures you similarly include via code chunks. You can include arbitrary static image files, as in Figure \@ref(fig:static-image). 

```{r static-image, fig.cap="Here's a little pretty fly.", description="An image of a fly"}
knitr::include_graphics("figures/fly.eps")
```

You can resize the figures with the chunk options `out.height` and `out.width`, as in Figure \@ref(fig:static-image-resized).

```{r static-image-resized, echo=FALSE, out.height='1in', out.width='1in', fig.cap="A sample black and white graphic that has been resized with the \\texttt{out.height} and \\texttt{out.width} chunk options.", description="A resized image of a fly"}
knitr::include_graphics("figures/fly.eps")
```

At the moment, if you need to style text in the caption, or include references in the caption, you need to use \LaTeX\ rather than markdown syntax. As the figure caption is a string, you must escape the \LaTeX\ syntax's `\` with another `\`, as we did in Figure \@ref(fig:static-image-resized).

### Margin figures
To place a figure in the margin, put it in a `\marginfigure` environment by setting the chunk option `fig.env = 'marginfigure'` as in Figure \@ref(fig:margin-figure). Note that we also set the image width to the width of the margin with `out.width='\\marginparwidth'`, and positions it with `vspaceout`.

```{r margin-figure, out.width='\\marginparwidth', fig.env='marginfigure', fig.cap="In this image, the cats are tessellated within a square frame. Images should also have captions and be within the boundaries of the sidebar on page~\\pageref{bar:arbitrary-sidebar}. Photo: \\cczero~jofish on Flickr.", description="Image of a cat placed in the margin of the document", vspaceout='-9cm'}
knitr::include_graphics("figures/cats.png")
```

### Full width figures
To make figures take up to the full width of the page, set the environment to `figure*` with the chunk option `fig.env = 'figure*'`. You may want to set its width to the full text width with the chunk option `out.width='\\fulltextwidth'`, as in Figure \@ref(fig:full-width-figure).

```{r full-width-figure, out.width='\\fulltextwidth', fig.env='figure*', fig.cap="In this image, the map maximizes use of space. Note that \\LaTeX\\ tends to render large figures on a dedicated page. Image: \\ccbynd~ayman on Flickr.", description="An image of a map spanning the full width of the page"}
knitr::include_graphics("figures/map.png")
```

### Dynamic figures
Again, the power of R Markdown is that you can include e.g. plots that are dynamically generated from the underlying data. For example, Figure \@ref(fig:basket-plot) is a simple visualisation of the basket data.

```{r basket-plot, fig.cap="Total number of goals by the top 3 players in made-up basketball season", out.width='\\marginparwidth', fig.env='marginfigure', fig.height=2, fig.width=4, description="A bar chart of number of goals made by 3 players in a made-up basketball data", vspaceout='-2cm'}
data %>%
  group_by(Player) %>%
  summarise(total_goals = sum(goals)) %>%
  arrange(desc(total_goals)) %>%
  head(3) %>%
  ggplot() +
    geom_bar(aes(x = Player, y = total_goals), stat = "identity") +
    labs(x = "", y = "Total goals") + 
    theme_minimal()
```

## Math Equations
You may want to display math equations in three distinct styles: inline, numbered or non-numbered display. Each of the three are discussed in the next sections. You can use usual \LaTeX\ syntax directly, or [R Markdown](https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html#theorems).

### Inline (In-text) Equations
A formula that appears in the running text is called an inline or in-text formula.  It is produced by the
**math** environment, which can be invoked by surrounding text with dollar signs: \$. You can use any of the symbols and structures, from $\alpha$ to $\omega$, available in \LaTeX\. For example, here's a nice equation inline: $\lim_{n\rightarrow \infty}x=0$. If you're writing in RStudio, you can even hover over it to see the rendered output displayed!

### Display Equations
A numbered display equation---one set off by vertical space from the text and centered horizontally---is produced by using \LaTeX\ syntax directly to put the content in an `equation` environment^[In fact, you can use any arbitrary \LaTeX\ syntax directly in your .Rmd document.]. So here's that nice equation from above:
\begin{equation}
\lim_{n\rightarrow \infty}x=0
\end{equation}

To make an unnumbered display equation,  surround the expression with two dollar signs:
$$
\lim_{n\rightarrow \infty}x=0
$$

## Theorem-like Constructs
See [bookdown.org](https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html#theorems) for guidance if you want to do it the R Markdown way. Here's the usual way, using \LaTeX\ syntax:

\begin{theorem}
  Let $f$ be continuous on $[a,b]$.  If $G$ is
  an antiderivative for $f$ on $[a,b]$, then
  \begin{displaymath}
    \int^b_af(t)\,dt = G(b) - G(a).
  \end{displaymath}
\end{theorem}

Here is a definition:
\begin{definition}
  If $z$ is irrational, then by $e^z$ we mean the
  unique number that has
  logarithm $z$:
  \begin{displaymath}
    \log e^z = z.
  \end{displaymath}
\end{definition}

In the ACM \LaTeX\ template, pre-defined theorem-like constructs are **theorem**, **conjecture**, **proposition**, **lemma** and **corollary**.  The pre-defined definition-like constructs are **example** and **definition**. See the documentation for the [2017 ACM Master article template](https://www.acm.org/publications/proceedings-template).

# Finishing touches
For the Extended Abstracts template in particular, it can be fiddly to get the final touches of the layout right, mostly in relation to the arrangement of the tables and figures in the margin. When you knit this template to PDF, the intermediary **.tex** file is stored in your working directory. You can make finishing touches in this .tex directly file (e.g. by uploading it to [OverLeaf](https://www.overleaf.com). In particular, you might want to add varying amounts of `\vspace{}` to position the margin content.

# Conclusions
If you prefer using Markdown syntax over \LaTeX, the CHI Proceedings format is a bit more straight-forward than the Extended Abstracts format, because the latter may force you to resort to more direct use of \LaTeX\ syntax to handle margin content appropriately. If you love \LaTeX, of course, it's entirely possible to exclusively use \LaTeX\ within R Markdown and only use R Markdown for its benefits of dynamic reporting of results.
